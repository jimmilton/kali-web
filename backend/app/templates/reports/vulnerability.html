<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ report.title }} - Vulnerability Report</title>
    <style>
        :root { --primary-color: {{ branding.primary_color or '#1e40af' }}; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Helvetica Neue', Arial, sans-serif; line-height: 1.6; color: #1f2937; font-size: 11pt; }
        .container { max-width: 900px; margin: 0 auto; padding: 30px; }
        h1 { color: var(--primary-color); font-size: 24px; margin-bottom: 20px; }
        h2 { color: var(--primary-color); font-size: 18px; margin: 25px 0 15px; }
        table { width: 100%; border-collapse: collapse; margin: 15px 0; font-size: 10pt; }
        th, td { border: 1px solid #d1d5db; padding: 8px; text-align: left; }
        th { background-color: var(--primary-color); color: white; }
        tr:nth-child(even) { background-color: #f9fafb; }
        .vuln-card { border: 1px solid #e5e7eb; border-radius: 8px; margin: 20px 0; page-break-inside: avoid; }
        .vuln-header { padding: 15px; background: #f3f4f6; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; }
        .vuln-body { padding: 15px; }
        .badge { padding: 4px 10px; border-radius: 4px; font-weight: bold; color: white; font-size: 10pt; }
        .badge-critical { background: #dc2626; }
        .badge-high { background: #ea580c; }
        .badge-medium { background: #ca8a04; }
        .badge-low { background: #16a34a; }
        .badge-info { background: #2563eb; }
        .evidence { background: #1f2937; color: #e5e7eb; padding: 12px; border-radius: 4px; font-family: monospace; font-size: 9pt; white-space: pre-wrap; overflow-x: auto; }
        .meta-table td { padding: 6px 12px; }
        .meta-table td:first-child { font-weight: 600; background: #f9fafb; width: 150px; }
        .section-label { font-weight: 600; color: #374151; margin: 15px 0 8px; }
        .summary-box { display: inline-block; text-align: center; padding: 15px 25px; margin: 5px; background: #f3f4f6; border-radius: 8px; }
        .summary-count { font-size: 28px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>{{ report.title }}</h1>
        <p>Project: {{ project.name if project else 'N/A' }} | Generated: {{ generated_at.strftime('%Y-%m-%d %H:%M UTC') }}</p>

        <!-- Summary -->
        <h2>Vulnerability Summary</h2>
        <div style="text-align: center; margin: 20px 0;">
            <div class="summary-box">
                <div class="summary-count" style="color: #dc2626;">{{ severity_counts.critical }}</div>
                <div>Critical</div>
            </div>
            <div class="summary-box">
                <div class="summary-count" style="color: #ea580c;">{{ severity_counts.high }}</div>
                <div>High</div>
            </div>
            <div class="summary-box">
                <div class="summary-count" style="color: #ca8a04;">{{ severity_counts.medium }}</div>
                <div>Medium</div>
            </div>
            <div class="summary-box">
                <div class="summary-count" style="color: #16a34a;">{{ severity_counts.low }}</div>
                <div>Low</div>
            </div>
            <div class="summary-box">
                <div class="summary-count" style="color: #2563eb;">{{ severity_counts.info }}</div>
                <div>Info</div>
            </div>
        </div>

        <!-- Vulnerability Table -->
        <h2>Vulnerability Index</h2>
        <table>
            <thead>
                <tr>
                    <th style="width: 40px;">#</th>
                    <th>Title</th>
                    <th style="width: 80px;">Severity</th>
                    <th style="width: 80px;">CVSS</th>
                    <th style="width: 100px;">Status</th>
                </tr>
            </thead>
            <tbody>
                {% for vuln in vulnerabilities %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td>{{ vuln.title }}</td>
                    <td><span class="badge badge-{{ vuln.severity }}">{{ vuln.severity|upper }}</span></td>
                    <td>{{ vuln.cvss_score or '-' }}</td>
                    <td>{{ vuln.status }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Detailed Findings -->
        <h2>Detailed Findings</h2>
        {% for vuln in vulnerabilities %}
        <div class="vuln-card">
            <div class="vuln-header">
                <strong>{{ loop.index }}. {{ vuln.title }}</strong>
                <span class="badge badge-{{ vuln.severity }}">{{ vuln.severity|upper }}</span>
            </div>
            <div class="vuln-body">
                <table class="meta-table" style="margin-bottom: 15px;">
                    <tr><td>Status</td><td>{{ vuln.status }}</td></tr>
                    {% if vuln.cvss_score %}<tr><td>CVSS Score</td><td>{{ vuln.cvss_score }}{% if vuln.cvss_vector %} ({{ vuln.cvss_vector }}){% endif %}</td></tr>{% endif %}
                    {% if vuln.cve_ids %}<tr><td>CVE IDs</td><td>{{ vuln.cve_ids|join(', ') }}</td></tr>{% endif %}
                    {% if vuln.cwe_ids %}<tr><td>CWE IDs</td><td>{{ vuln.cwe_ids|join(', ') }}</td></tr>{% endif %}
                    {% if vuln.asset %}<tr><td>Affected Asset</td><td>{{ vuln.asset.type }}: {{ vuln.asset.value }}</td></tr>{% endif %}
                    {% if vuln.tool_name %}<tr><td>Discovered By</td><td>{{ vuln.tool_name }}</td></tr>{% endif %}
                </table>

                {% if vuln.description %}
                <div class="section-label">Description</div>
                <p>{{ vuln.description }}</p>
                {% endif %}

                {% if content.include_evidence and vuln.evidence %}
                <div class="section-label">Evidence</div>
                <div class="evidence">{{ vuln.evidence }}</div>
                {% endif %}

                {% if content.include_evidence and vuln.request %}
                <div class="section-label">Request</div>
                <div class="evidence">{{ vuln.request }}</div>
                {% endif %}

                {% if content.include_evidence and vuln.response %}
                <div class="section-label">Response</div>
                <div class="evidence">{{ vuln.response[:2000] }}{% if vuln.response|length > 2000 %}...{% endif %}</div>
                {% endif %}

                {% if content.include_remediation and vuln.remediation %}
                <div class="section-label">Remediation</div>
                <p>{{ vuln.remediation }}</p>
                {% endif %}

                {% if content.include_references and vuln.references %}
                <div class="section-label">References</div>
                <ul style="padding-left: 20px;">
                    {% for ref in vuln.references %}
                    <li><a href="{{ ref }}" style="color: var(--primary-color);">{{ ref }}</a></li>
                    {% endfor %}
                </ul>
                {% endif %}
            </div>
        </div>
        {% endfor %}

        <div style="text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid #e5e7eb; font-size: 10pt; color: #6b7280;">
            {{ branding.footer_text or 'Confidential Security Report' }}
        </div>
    </div>
</body>
</html>
